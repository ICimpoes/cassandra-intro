# Cassandra
Cassandra is massively linearly scalable NoSQL database

  - Fully distributed, with no single point of failure
  - Free and open source
  - Highly performant, with near-linear horizontal scaling in proper use cases

### Cassandra Query Language(CQL)
Cassandra models data using CQL.
CQL provides a familiar, row-column, SQL-like approach
  * CREATE, ALTER, DROP
  * SELECT, INSERT, UPDATE, DELETE

```SQL
CREATE TABLE Performer (
  name VARCHAR,
  country VARCHAR,
  style VARCHAR,
  born INT,
  died INT,
  PRIMARY KEY (name)
);
```

## Internal architecture

### Cluster
Cluster is a peer to peer (no master, no slaves) set of nodes.
  * **Node** - one Cassandra instance
  * **Rack** - a logical set of nodes with single point of failure
  * **Datacenter** - a logical set of racks (usually physically distributed).
  * **Cluster** – the full set of nodes which map to a single complete token ring

![alt text](/img/cassandra-cluster.jpg "Cassandra cluster")

### Coordinator

Coordinator is the node chosen by the client to receive a particular read or write request to its cluster.  
**Any** node can coordinate **any** request.

  * The coordinator manages the Replication Factor
  * The coordinator applies the Consistency Level

![alt text](/img/cassandra-coordinator.jpg "Cassandra coordinator")

### Consistent hashing

Data is stored on nodes in partitions, each identified by a unique token.
  * **Partition** - a storage location on a node (analogous to a "table row")
  * **Token** - integer value generated by a hashing algorithm, identifying a partition's location within a cluster

#### What is the partitioner?
Imagine a 0 to 100 token range (instead of -2^63 to +2^63)

  * Each node is assigned a token, just like each of its partitions

A node's partitioner hashes a token from the partition key value of a write request
ex:
```SQL
CREATE TABLE Users (
  firstname text,
  lastname text,
  level text,
  PRIMARY KEY ((lastname, firstname))
);
```
Here ```(lastname, firstname)``` is *partition key*
```SQL
INSERT INTO Users (firstname, lastname, level)
  VALUES ('Oscar', 'Orange', 42);
```
What happens:
![alt text](/img/cassandra-partitioner.jpg "Cassandra partitioner")
